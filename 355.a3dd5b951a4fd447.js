"use strict";(self.webpackChunksyahrul=self.webpackChunksyahrul||[]).push([[355],{5355:(I,x,u)=>{u.r(x),u.d(x,{TetrisModule:()=>B});var y=u(9808),T=u(2268),e=u(5e3),w=u(2313);const l=30,g=["none","cyan","lightblue","yellow","green","pink","red"],C=[[],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]];let p=(()=>{class s{}return s.ESC="Escape",s.SPACE=" ",s.LEFT="ArrowLeft",s.UP="ArrowUp",s.RIGHT="ArrowRight",s.DOWN="ArrowDown",s})(),m=(()=>{class s{}return s.SINGLE=100,s.DOUBLE=300,s.TRIPLE=500,s.TETRIS=800,s.SOFT_DROP=1,s.HARD_DROP=2,s})();class a{}a[0]=200,a[1]=190,a[2]=180,a[3]=170,a[4]=160,a[5]=150,a[6]=140,a[7]=130,a[8]=120,a[9]=100,a[10]=80,a[11]=80,a[12]=80,a[13]=70,a[14]=70,a[15]=70,a[16]=50,a[17]=50,a[18]=50,a[19]=30,a[20]=30;class v{constructor(n){this.ctx=n,this.spawn()}spawn(){const n=this.randomizeTetrominoType(g.length-1);this.shape=C[n],this.color=g[n],this.x=4===n?4:3,this.y=0}draw(){const n=1/l;this.shape.forEach((t,i)=>{t.forEach((o,r)=>{o>0&&(this.ctx.fillStyle="black",this.ctx.fillRect(this.x+r-n,this.y+i-n,1+2*n,1+2*n),this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x+r,this.y+i,1,1))})})}drawNext(n){n.clearRect(0,0,n.canvas.width,n.canvas.height);const t=1/l;this.shape.forEach((i,o)=>{i.forEach((r,c)=>{r>0&&(n.fillStyle="black",n.fillRect(c+.05-t,o+.05-t,1+2*t,1+2*t),n.fillStyle=this.color,n.fillRect(c+.05,o+.05,1,1))})})}move(n){this.x=n.x,this.y=n.y,this.shape=n.shape}randomizeTetrominoType(n){return Math.floor(Math.random()*n+1)}}let A=(()=>{class s{valid(t,i){return t.shape.every((o,r)=>o.every((c,h)=>{let O=t.x+h,E=t.y+r;return this.isEmpty(c)||this.insideWalls(O)&&this.aboveFloor(E)&&this.notOccupied(i,O,E)}))}isEmpty(t){return 0===t}insideWalls(t){return t>=0&&t<10}aboveFloor(t){return t<=20}notOccupied(t,i,o){return t[o]&&0===t[o][i]}rotate(t){let i=JSON.parse(JSON.stringify(t));for(let o=0;o<i.shape.length;++o)for(let r=0;r<o;++r)[i.shape[r][o],i.shape[o][r]]=[i.shape[o][r],i.shape[r][o]];return i.shape.forEach(o=>o.reverse()),i}getLinesClearedPoints(t,i){return(i+1)*(1===t?m.SINGLE:2===t?m.DOUBLE:3===t?m.TRIPLE:4===t?m.TETRIS:0)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();const S=["board"],_=["next"];function P(s,n){1&s&&(e.TgZ(0,"p"),e._uU(1,"Next Block"),e.qZA())}let k=(()=>{class s{constructor(t){this.service=t,this.moves={[p.LEFT]:i=>Object.assign(Object.assign({},i),{x:i.x-1}),[p.RIGHT]:i=>Object.assign(Object.assign({},i),{x:i.x+1}),[p.DOWN]:i=>Object.assign(Object.assign({},i),{y:i.y+1}),[p.SPACE]:i=>Object.assign(Object.assign({},i),{y:i.y+1}),[p.UP]:i=>this.service.rotate(i)}}keyEvent(t){if("Escape"===t.key)this.gameOver();else if(this.moves[t.key]){t.preventDefault();let i=this.moves[t.key](this.piece);if(" "===t.key)for(;this.service.valid(i,this.board);)this.points+=m.HARD_DROP,this.piece.move(i),i=this.moves[p.DOWN](this.piece);else this.service.valid(i,this.board)&&(this.piece.move(i),"ArrowDown"===t.key&&(this.points+=m.SOFT_DROP))}}ngOnInit(){this.initBoard(),this.initNext(),this.resetGame()}initBoard(){this.ctx=this.canvas.nativeElement.getContext("2d"),this.ctx.canvas.width=300,this.ctx.canvas.height=600,this.drawBoardBackground(),this.ctx.scale(l,l)}initNext(){this.ctxNext=this.canvasNext.nativeElement.getContext("2d"),this.ctxNext.canvas.width=150,this.ctxNext.canvas.height=120,this.ctxNext.scale(l,l)}play(){this.resetGame(),this.next=new v(this.ctx),this.piece=new v(this.ctx),this.next.drawNext(this.ctxNext),this.time.start=performance.now(),this.requestId&&cancelAnimationFrame(this.requestId),this.animate()}pause(){!this.requestId||this.isGameOver||(this.isPause=!this.isPause,!this.isPause&&this.requestId?this.animate():(cancelAnimationFrame(this.requestId),this.ctx.fillStyle="black",this.ctx.fillRect(2,2,6,2.5),this.ctx.font="2px miso-bold",this.ctx.fillStyle="red",this.ctx.fillText("PAUSED",2.65,3.9)))}drawBoardBackground(){this.ctx.setTransform(1,0,0,1,0,0);for(let c=0;c<=300;c+=30){let h=0;c>0&&(h=c+.5),300===c&&(h=c),this.ctx.moveTo(h,0),this.ctx.lineTo(h,600)}for(let c=0;c<=600;c+=30){let h=0;c>0&&(h=c+.5),600===c&&(h=c),this.ctx.moveTo(0,h),this.ctx.lineTo(300,h)}this.ctx.strokeStyle="#cacaca",this.ctx.stroke()}resetGame(){this.points=0,this.lines=0,this.level=0,this.board=this.getEmptyBoard(),this.time={start:0,elapsed:0,level:a[this.level]},this.isPause=!1,this.isGameOver=!1}animate(t=0){this.time.elapsed=t-this.time.start,this.time.elapsed>this.time.level&&(this.time.start=t,!this.drop())?this.gameOver():(this.draw(),this.isPause||(this.requestId=requestAnimationFrame(this.animate.bind(this))))}draw(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawBoardBackground(),this.ctx.scale(l,l),this.piece.draw(),this.drawBoard()}drop(){let t=this.moves[p.DOWN](this.piece);if(this.service.valid(t,this.board))this.piece.move(t);else{if(this.freeze(),this.clearLines(),0===this.piece.y)return!1;this.piece=this.next,this.next=new v(this.ctx),this.next.drawNext(this.ctxNext)}return!0}clearLines(){let t=0;this.board.forEach((i,o)=>{i.every(r=>0!==r)&&(t++,this.board.splice(o,1),this.board.unshift(Array(10).fill(0)))}),t>0&&(this.points+=this.service.getLinesClearedPoints(t,this.level),this.lines+=t,this.lines>=10&&(this.level++,this.lines-=10,this.time.level=a[this.level]))}freeze(){this.piece.shape.forEach((t,i)=>{t.forEach((o,r)=>{o>0&&(this.board[i+this.piece.y][r+this.piece.x]=o)})})}drawBoard(){const t=1/l;this.board.forEach((i,o)=>{i.forEach((r,c)=>{r>0&&(this.ctx.fillStyle="black",this.ctx.fillRect(c-t,o-t,1+2*t,1+2*t),this.ctx.fillStyle=g[r],this.ctx.fillRect(c,o,1,1))})})}gameOver(){cancelAnimationFrame(this.requestId),this.isGameOver=!0,this.ctx.fillStyle="black",this.ctx.fillRect(1,2,8,2.5),this.ctx.font="2px miso-bold",this.ctx.fillStyle="red",this.ctx.fillText("GAME OVER",1.4,3.9)}getEmptyBoard(){return Array.from({length:20},()=>Array(10).fill(0))}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(A))},s.\u0275cmp=e.Xpm({type:s,selectors:[["tetris-board"]],viewQuery:function(t,i){if(1&t&&(e.Gf(S,7),e.Gf(_,7)),2&t){let o;e.iGM(o=e.CRH())&&(i.canvas=o.first),e.iGM(o=e.CRH())&&(i.canvasNext=o.first)}},hostBindings:function(t,i){1&t&&e.NdJ("keydown",function(r){return i.keyEvent(r)},!1,e.Jf7)},decls:22,vars:3,consts:[[1,"container"],[1,"d-inline-block","align-top"],[1,"game-board"],["board",""],[1,"d-inline-block","align-top","ml-1"],[1,"result"],[4,"ngIf"],[1,"next"],["next",""],[1,"button-container"],[1,"button","play-button",3,"click"],[1,"button","pause-button",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"canvas",2,3),e.qZA(),e.TgZ(4,"div",4)(5,"div",5)(6,"p")(7,"span"),e._uU(8,"Score"),e.qZA(),e._uU(9),e.qZA(),e.TgZ(10,"p")(11,"span"),e._uU(12,"Level"),e.qZA(),e._uU(13),e.qZA(),e.YNc(14,P,2,0,"p",6),e._UZ(15,"canvas",7,8),e.qZA(),e.TgZ(17,"div",9)(18,"button",10),e.NdJ("click",function(){return i.play()}),e._uU(19,"Play"),e.qZA(),e.TgZ(20,"button",11),e.NdJ("click",function(){return i.pause()}),e._uU(21,"Pause"),e.qZA()()()()),2&t&&(e.xp6(9),e.hij(": ",i.points,""),e.xp6(4),e.hij(": ",i.level,""),e.xp6(1),e.Q6J("ngIf",i.requestId))},directives:[y.O5],styles:["[_nghost-%COMP%]{text-align:center}.game-board[_ngcontent-%COMP%]{border:1px solid #000}.result[_ngcontent-%COMP%]{text-align:left;margin-left:20px;font-family:var(--font-miso)}.result[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px;font-family:Roboto}.result[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:60px;display:inline-block}.button-container[_ngcontent-%COMP%]{margin-left:20px}.button[_ngcontent-%COMP%]{font-size:16px;padding:15px 30px;cursor:pointer;border:1px solid #000;margin-right:10px}.play-button[_ngcontent-%COMP%]{background-color:#ca2c29;color:#fff}.pause-button[_ngcontent-%COMP%]{background-color:#2b84d2;color:#fff}"]}),s})();const Z=[{path:"",component:(()=>{class s{constructor(t){this.titleService=t}ngOnInit(){this.titleService.setTitle("Syahrul - Tetris")}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(w.Dx))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-tetris"]],decls:23,vars:0,consts:[[1,"container"],[1,"content-container"],[1,"page-title"],[1,"content"],[1,"row"],[1,"col-sm-3"],["href","https://medium.com/angular-in-depth/game-development-tetris-in-angular-64ef96ce56f7","target","_blank"],[1,"col-sm-9"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),e._uU(3,"Tetris"),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"h1"),e._uU(8,"Introduction"),e.qZA(),e.TgZ(9,"p"),e._uU(10,"A fun project! You can follow the explanation "),e.TgZ(11,"a",6),e._uU(12,"here"),e.qZA()(),e.TgZ(13,"h1"),e._uU(14,"How to use"),e.qZA(),e.TgZ(15,"p"),e._uU(16,"Up Arrow (\u2191) to rotate the piece"),e.qZA(),e.TgZ(17,"p"),e._uU(18,"Down Arrow (\u2193) to hard drop"),e.qZA(),e.TgZ(19,"p"),e._uU(20,"Left (\u2190) and Right (\u2192) arrow to move the piece"),e.qZA()(),e.TgZ(21,"div",7),e._UZ(22,"tetris-board"),e.qZA()()()()())},directives:[k],styles:[""]}),s})()}];let R=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[T.Bz.forChild(Z)],T.Bz]}),s})(),B=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[y.ez,R]]}),s})()}}]);